---
import type { FooterProps } from "@/lib/data/site";
import Icon from "@/components/Icon.astro";
import { icons } from "@/lib/icons";
import NewsletterForm from "@/components/NewsletterForm.astro";
import SocialLinks from "./SocialLinks.astro";

const { siteName, logoSrc, address, contact, socials, nav, legalLinks, year } = Astro.props as FooterProps;

const phone = contact?.phone ?? "";
const email = contact?.email ?? "";
const hours = contact?.hours ?? "";
const telHref = contact?.telHref ?? (phone ? `tel:${phone.replace(/[^\d+]/g, "")}` : "");
const mailHref = contact?.mailHref ?? (email ? `mailto:${email}` : "");

function joinAddress(a?: { street?: string; city?: string; state?: string; zip?: string }) {
  if (!a) return "";
  return [a.street, [a.city, a.state].filter(Boolean).join(", "), a.zip].filter(Boolean).join(" · ");
}
---

<footer class="mt-16 border-t bg-primary text-white bg-[url('/images/bg_footer.jpg')] bg-cover bg-center">
  <div class="mx-auto max-w-7xl px-4 py-10 grid gap-8 md:grid-cols-3">
    <!-- Col 1: Brand + Contact (inner 2-col) -->
    <div class="grid gap-6 items-start md:grid-cols-2">
      <!-- Logo -->
      {
        logoSrc && (
          <a href="/" class="inline-block justify-self-center md:justify-self-start md:mt-1" aria-label={siteName}>
            <img
              src={logoSrc}
              alt="Mid Mo Tours"
              class="h-auto w-auto max-w-40 object-contain"
              loading="lazy"
              decoding="async"
            />
          </a>
        )
      }

      <!-- Contact -->
      <div>
        <h2 class="text-2xl font-black italic tracking-wide">{siteName}</h2>
        {joinAddress(address) && <p class="mt-2 text-sm">{joinAddress(address)}</p>}

        {
          (phone || email || hours) && (
            <ul class="mt-3 space-y-1 text-sm" role="list">
              {phone && (
                <li>
                  <a href={telHref} class="inline-flex items-center gap-2 hover:text-accent">
                    <Icon html={icons.phone} />
                    <span class="sr-only">Phone:</span>
                    {phone}
                  </a>
                </li>
              )}
              {email && (
                <li>
                  <a href={mailHref} class="inline-flex items-center gap-2 hover:text-accent">
                    <Icon html={icons.envelope} />
                    <span class="sr-only">Email:</span>
                    {email}
                  </a>
                </li>
              )}
              {hours && (
                <li class="inline-flex items-center gap-2">
                  <Icon html={icons.clock} />
                  <span class="sr-only">Hours:</span>
                  {hours}
                </li>
              )}
            </ul>
          )
        }
      </div>
    </div>

    <!-- Col 2: Navigation (inner 2-col) -->
    <div class="grid gap-2 md:grid-cols-2 text-sm">
      <!-- Explore -->
      <nav aria-label="Explore">
        <h3 class="text-lg font-bold text-accent">Tours</h3>
        <ul class="mt-3 space-y-2">
          {
            nav.tours.map((item) => (
              <li>
                <a href={item.href} class="hover:text-accent">
                  {item.label}
                </a>
              </li>
            ))
          }
        </ul>
      </nav>

      <!-- Company -->
      <nav aria-label="Company">
        <h3 class="text-lg font-bold text-accent">Company</h3>
        <ul class="mt-3 space-y-2">
          {
            nav.company.map((item) => (
              <li>
                <a href={item.href} class="hover:text-accent">
                  {item.label}
                </a>
              </li>
            ))
          }
        </ul>
      </nav>
    </div>

    <!-- Col 3: Newsletter -->
    <div>
      <h3 class="text-lg font-bold text-accent mb-4">Join our newsletter</h3>
      <p class="text-white text-sm mt-4 hidden">Trip announcements, special packages, and local tips.</p>
      <NewsletterForm />
    </div>
  </div>
</footer>

<div class="border-t">
  <div class="mx-auto max-w-7xl px-4 py-4 flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
    <p class="text-xs">© {year} {siteName}. All rights reserved.</p>
    <ul class="text-xs flex flex-wrap items-center gap-x-4 gap-y-2">
      {
        legalLinks.map((item) => (
          <li>
            <a href={item.href} class="hover:text-accent">
              {item.label}
            </a>
          </li>
        ))
      }
    </ul>
    <SocialLinks links={socials} variant="footer" />
  </div>
</div>
